name: CI

on:
  pull_request:
  push:
    branches: [main]

jobs:
  repo-sanity:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Basic sanity checks
        shell: bash
        run: |
          set -euo pipefail

          echo "Checking required files..."
          test -f README.md
          test -f .gitignore
          test -f .editorconfig
          test -f .gitattributes

          echo "Ensuring no .env files are committed..."
          if git ls-files | grep -E '(^|/)\.env(\.|$)'; then
            echo "Found committed .env file(s). Remove them and use .env.example instead."
            exit 1
          fi

          echo "Checking for accidental secrets (best-effort tripwire)..."
          # Exclusions prevent false positives (workflows, docs, deps, build output).
          if git grep -nEI "(api[_-]?key|secret|firebase|service[_-]?account|private[_-]?key)" -- . \
            ':!README.md' \
            ':!docs/**' \
            ':!.github/**' \
            ':!**/node_modules/**' \
            ':!**/dist/**' \
            ':!**/build/**' \
            ':!**/.next/**' \
            ':!**/__pycache__/**' \
            ':!**/.venv/**'; then
            echo "Potential secret-like string found. Review the matches above."
            exit 1
          fi

          echo "âœ… Repo sanity checks passed."
